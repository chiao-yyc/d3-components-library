#!/bin/sh
# D3 Components åˆ†å±¤ ESLint ç­–ç•¥
echo "ğŸ¯ D3 Components å“è³ªæª¢æŸ¥é–‹å§‹..."

# æª¢æŸ¥ç•°å‹•æª”æ¡ˆé¡å‹ä¸¦åŸ·è¡Œå°æ‡‰æª¢æŸ¥ç­–ç•¥
REGISTRY_CHANGED=$(git diff --cached --name-only | grep "^registry/" | wc -l)
CLI_CHANGED=$(git diff --cached --name-only | grep "^cli/" | wc -l)
DEMO_CHANGED=$(git diff --cached --name-only | grep "^demo/" | wc -l)

# Registry ç•°å‹• - åš´æ ¼æª¢æŸ¥ ğŸ”´
if [ $REGISTRY_CHANGED -gt 0 ]; then
  echo "ğŸ”´ Registry ç•°å‹•åµæ¸¬ ($REGISTRY_CHANGED æª”æ¡ˆ)ï¼ŒåŸ·è¡Œåš´æ ¼å“è³ªæª¢æŸ¥..."
  cd registry
  
  echo "   ğŸ“ TypeScript åš´æ ¼å‹åˆ¥æª¢æŸ¥..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "   âŒ Registry TypeScript æª¢æŸ¥å¤±æ•—"
    exit 1
  fi
  
  echo "   ğŸ” ESLint åš´æ ¼è¦å‰‡æª¢æŸ¥..."
  npm run lint:strict
  if [ $? -ne 0 ]; then
    echo "   âŒ Registry å¿…é ˆé€šéæ‰€æœ‰ ESLint åš´æ ¼æª¢æŸ¥"
    exit 1
  fi
  
  echo "   âœ… Registry å“è³ªæª¢æŸ¥é€šé"
  cd ..
fi

# CLI ç•°å‹• - ä¸­ç­‰æª¢æŸ¥ ğŸŸ¡
if [ $CLI_CHANGED -gt 0 ]; then
  echo "ğŸŸ¡ CLI ç•°å‹•åµæ¸¬ ($CLI_CHANGED æª”æ¡ˆ)ï¼ŒåŸ·è¡ŒåŸºæœ¬å“è³ªæª¢æŸ¥..."
  cd cli
  
  echo "   ğŸ” åŸºæœ¬ ESLint æª¢æŸ¥..."
  npm run lint
  if [ $? -ne 0 ]; then
    echo "   âŒ CLI åŸºæœ¬æª¢æŸ¥å¤±æ•—"
    exit 1
  fi
  
  echo "   âœ… CLI å“è³ªæª¢æŸ¥é€šé"
  cd ..
fi

# Demo ç•°å‹• - æ¶æ§‹åˆè¦æ€§æª¢æŸ¥ ğŸŸ¢
if [ $DEMO_CHANGED -gt 0 ]; then
  echo "ğŸŸ¢ Demo ç•°å‹•åµæ¸¬ ($DEMO_CHANGED æª”æ¡ˆ)ï¼ŒåŸ·è¡Œæ¶æ§‹åˆè¦æ€§æª¢æŸ¥..."
  cd demo
  
  echo "   ğŸ—ï¸  æ¶æ§‹åˆè¦æ€§æª¢æŸ¥..."
  npm run lint:architecture
  if [ $? -ne 0 ]; then
    echo "   âŒ Demo æ¶æ§‹åˆè¦æ€§æª¢æŸ¥å¤±æ•—"
    exit 1
  fi
  
  echo "   ğŸ“Š é é¢æ¨¡å¼é©—è­‰..."
  npm run check:compliance || true
  # æ³¨æ„ï¼šé€™è£¡ä¸å¼·åˆ¶é€€å‡ºï¼Œåƒ…ä½œç‚ºæé†’ï¼ˆå³ä½¿æª¢æŸ¥å¤±æ•—ä¹Ÿç¹¼çºŒï¼‰
  
  echo "   âœ… Demo æ¶æ§‹æª¢æŸ¥å®Œæˆ"
  cd ..
fi

# å¦‚æœæ²’æœ‰ä»»ä½•ç•°å‹•
if [ $REGISTRY_CHANGED -eq 0 ] && [ $CLI_CHANGED -eq 0 ] && [ $DEMO_CHANGED -eq 0 ]; then
  echo "â„¹ï¸  æ²’æœ‰åµæ¸¬åˆ° registryã€cli æˆ– demo çš„æª”æ¡ˆç•°å‹•"
fi

echo "ğŸ‰ æ‰€æœ‰å“è³ªæª¢æŸ¥å®Œæˆï¼"
